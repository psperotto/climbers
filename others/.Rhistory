names(aridity) <- names(mechanisms) <- subset_merged_table$taxon_and_author
mechanisms[which(mechanisms==1)] <- "Twining"
mechanisms[which(mechanisms==2)] <- "Tendrils"
mechanisms[which(mechanisms==3)] <- "Simple_scrambling"
mechanisms[which(mechanisms==4)] <- "Adhesive_roots"
mechanisms[which(mechanisms==5)] <- "Prehensile_branches"
mechanisms[which(mechanisms==6)] <- "Prehensile_petioles"
mechanisms[which(mechanisms==7)] <- "Hooks_or_grapnels"
phyanova <- phylANOVA(pruned_tree, mechanisms, aridity, nsim=10000, p.adj="bonferroni")
sink("phylanova_AI_results.txt")
print(phyanova)
sink()
print(phyanova)
print(phyanova)
rm(list=ls())
library(ape)
library(phangorn)
library(parallel)
library(geiger)
setwd("~/Desktop/Pubs_inprep/WCVP_special_issue/Patricia_Climbers/climbers")
climber_clades_stem <- readRDS("stem.bg.clades.list.Rdata")
all_climbers_stem <- climber_clades_stem[[7]]
# get diversification rates
lsca.df.sum1 <- all_climbers_stem[1:6,]
epsilon_high <- 0.9 #
root.age <- as.numeric(lsca.df.sum1[1,'age_mean'])
r_all_angios <- bd.ms(time = as.numeric(lsca.df.sum1[1,'age_mean']), n = as.numeric(lsca.df.sum1[1,'diversity']), crown = FALSE, epsilon = epsilon_high)
r_magnoliids <- bd.ms(time = as.numeric(lsca.df.sum1[2,'age_mean']), n = as.numeric(lsca.df.sum1[2,'diversity']), crown = FALSE, epsilon = epsilon_high)
r_monocots <- bd.ms(time = as.numeric(lsca.df.sum1[3,'age_mean']), n = as.numeric(lsca.df.sum1[3,'diversity']), crown = FALSE, epsilon = epsilon_high)
r_rosids <- bd.ms(time = as.numeric(lsca.df.sum1[4,'age_mean']), n = as.numeric(lsca.df.sum1[4,'diversity']), crown = FALSE, epsilon = epsilon_high)
r_asterids <- bd.ms(time = as.numeric(lsca.df.sum1[5,'age_mean']), n = as.numeric(lsca.df.sum1[5,'diversity']), crown = FALSE, epsilon = epsilon_high)
r_ranunculales <- bd.ms(time = as.numeric(lsca.df.sum1[6,'age_mean']), n = as.numeric(lsca.df.sum1[6,'diversity']), crown = FALSE, epsilon = epsilon_high)
tot.div1 <- c(as.numeric(lsca.df.sum1[1,'diversity']),
as.numeric(lsca.df.sum1[2,'diversity']),
as.numeric(lsca.df.sum1[3,'diversity']),
as.numeric(lsca.df.sum1[4,'diversity']),
as.numeric(lsca.df.sum1[5,'diversity']),
as.numeric(lsca.df.sum1[6,'diversity']))
all_r <- c(r_all_angios, r_magnoliids, r_monocots, r_rosids, r_asterids, r_ranunculales)
getStemLimits <- function(time, e=epsilon, r) {
t(sapply(time, stem.limits, epsilon=e, r=r))
}
limits <- mclapply(all_r, getStemLimits, time=2:root.age, e=epsilon_high, mc.cores = detectCores()-1)
limits.df_high <- data.frame(rbind(limits[[1]], limits[[2]],
limits[[3]], limits[[4]],
limits[[5]], limits[[6]]),
Diversity=factor(rep(tot.div1, each=nrow(limits[[1]]))),
r=rep(all_r, each=nrow(limits[[1]])))
colnames(limits.df_high)[1:2] <- c("lb", "ub")
epsilon_low <- 0 #
root.age <- as.numeric(lsca.df.sum1[1,'age_mean'])
r_all_angios <- bd.ms(time = as.numeric(lsca.df.sum1[1,'age_mean']), n = as.numeric(lsca.df.sum1[1,'diversity']), crown = FALSE, epsilon = epsilon_low)
r_magnoliids <- bd.ms(time = as.numeric(lsca.df.sum1[2,'age_mean']), n = as.numeric(lsca.df.sum1[2,'diversity']), crown = FALSE, epsilon = epsilon_low)
r_monocots <- bd.ms(time = as.numeric(lsca.df.sum1[3,'age_mean']), n = as.numeric(lsca.df.sum1[3,'diversity']), crown = FALSE, epsilon = epsilon_low)
r_rosids <- bd.ms(time = as.numeric(lsca.df.sum1[4,'age_mean']), n = as.numeric(lsca.df.sum1[4,'diversity']), crown = FALSE, epsilon = epsilon_low)
r_asterids <- bd.ms(time = as.numeric(lsca.df.sum1[5,'age_mean']), n = as.numeric(lsca.df.sum1[5,'diversity']), crown = FALSE, epsilon = epsilon_low)
r_ranunculales <- bd.ms(time = as.numeric(lsca.df.sum1[6,'age_mean']), n = as.numeric(lsca.df.sum1[6,'diversity']), crown = FALSE, epsilon = epsilon_low)
tot.div1 <- c(as.numeric(lsca.df.sum1[1,'diversity']),
as.numeric(lsca.df.sum1[2,'diversity']),
as.numeric(lsca.df.sum1[3,'diversity']),
as.numeric(lsca.df.sum1[4,'diversity']),
as.numeric(lsca.df.sum1[5,'diversity']),
as.numeric(lsca.df.sum1[6,'diversity']))
all_r <- c(r_all_angios, r_magnoliids, r_monocots, r_rosids, r_asterids, r_ranunculales)
getStemLimits <- function(time, e=epsilon, r) {
t(sapply(time, stem.limits, epsilon=e, r=r))
}
limits <- mclapply(all_r, getStemLimits, time=2:root.age, e=epsilon_low, mc.cores = detectCores()-1)
limits.df_low <- data.frame(rbind(limits[[1]], limits[[2]],
limits[[3]], limits[[4]],
limits[[5]], limits[[6]]),
Diversity=factor(rep(tot.div1, each=nrow(limits[[1]]))),
r=rep(all_r, each=nrow(limits[[1]])))
colnames(limits.df_low)[1:2] <- c("lb", "ub")
################################################
subset_stem <- subset(all_climbers_stem, !is.na(all_climbers_stem$clade))
subset_stem_t <- subset(subset_stem, subset_stem$CM==2)
subset_stem_other <- subset(subset_stem, subset_stem$CM!=2)
# adding axes
par(lwd=.6)
axis(side=1, at = seq(0,260,10), labels = seq(0,260,10), tick = TRUE, line = 0, lwd = .4, cex.axis=.6, tcl=NA, mgp=c(0,0.1,0),las=1, cex.lab=.4)
axis(side=2, at = 10^{0:5}, labels = 10^{0:5}, tick = TRUE, line = 0, lwd = .4, cex.axis=.6, tcl=NA, mgp=c(2.5,0.2,0),las=1)
mtext(text="Stem age (Mya)", side=1, line=1, cex=.5)
par(las=0)
pal <- hcl.colors(5, palette = "Viridis", alpha = 0.7)
names(pal) <- c("Superasterids","Superrosids","Ranunculales","Monocots","Magnoliids")
plot(x=subset_stem_t$age_mean[subset_stem_t$clade=="Superrosids"], y=subset_stem_t$diversity[subset_stem_t$clade=="Superrosids"], ylim=c(1,1000), xlim=c(0,30), log="y", xaxt="n", yaxt="n", bty="n", xlab="", ylab="", pch=24, bg=pal['Superrosids'], cex=1, lwd=0.5)
points(x=subset_stem_other$age_mean[subset_stem_other$clade=="Superrosids"], y=subset_stem_other$diversity[subset_stem_other$clade=="Superrosids"], pch=21, bg=pal['Superrosids'], cex=1, lwd=0.5)
# adding axes
par(lwd=.6)
axis(side=1, at = seq(0,260,10), labels = seq(0,260,10), tick = TRUE, line = 0, lwd = .4, cex.axis=.6, tcl=NA, mgp=c(0,0.1,0),las=1, cex.lab=.4)
axis(side=2, at = 10^{0:5}, labels = 10^{0:5}, tick = TRUE, line = 0, lwd = .4, cex.axis=.6, tcl=NA, mgp=c(2.5,0.2,0),las=1)
mtext(text="Stem age (Mya)", side=1, line=1, cex=.5)
par(las=0)
mtext(text="Species richness", side=2, line=1.5, cex=.5)
par(lwd=.5)
# adding CI lines
length_x <- length(limits.df_low$lb[limits.df_low$Diversity==111856])
lines(y=limits.df_low$lb[limits.df_low$Diversity==111856], x=1:length_x)
lines(y=limits.df_low$ub[limits.df_low$Diversity==111856], x=1:length_x)
lines(y=limits.df_high$lb[limits.df_high$Diversity==111856], x=1:length_x,lty=2)
lines(y=limits.df_high$ub[limits.df_high$Diversity==111856], x=1:length_x,lty=2)
#legend(lty=1:5, c("All angiosperms","Magnoliids","Monocots","Superasterids","Superrosids"), x=150, y=5, bty="n", cex = .7, lwd=.8)
legend(pch=c(21,24), legend = c("other", "tendrils"), x=0, y=1000, bty="n", cex = .7, pt.cex=1.25)
################
test.line_low <- approxfun(x=1:length_x, y=limits.df_low$lb[limits.df_low$Diversity==111856])
test.line_high <- approxfun(x=1:length_x, y=limits.df_high$ub[limits.df_high$Diversity==111856])
keep <- c()
for(i in 1:nrow(subset_stem)) {
if(!is.na(test.line_low(subset_stem$age_mean[i]))){
if(test.line_low(subset_stem$age_mean[i]) > subset_stem$diversity[i])
keep <- c(keep,i)
}
}
keep
keep <- c()
for(i in 1:nrow(subset_stem)) {
if(!is.na(test.line_low(subset_stem$age_mean[i]))){
if(test.line_low(subset_stem$age_mean[i]) > subset_stem$diversity[i])
keep <- c(keep,i)
}
}
keep
keep
# clades below lower bound:
lower_div <- as.data.frame(subset_stem[keep,])
lower_div <- subset(lower_div, lower_div$clade=="Superrosids")
write.csv(lower_div, file="clades_below_lower_bound_stem_rosids.csv")
keep <- c()
for(i in 1:nrow(subset_stem)) {
if(!is.na(test.line_high(subset_stem$age_mean[i]))){
if(test.line_high(subset_stem$age_mean[i]) < subset_stem$diversity[i])
keep <- c(keep,i)
}
}
# clades above upper bound:
upper_div <- as.data.frame(subset_stem[keep,])
upper_div <- subset(upper_div, upper_div$clade=="Superrosids")
upper_div
# Diversification analyses
setwd("~/Desktop/Pubs_inprep/WCVP_special_issue/Patricia_Climbers/climbers")
#rm(list=ls())
library(geiger)
library(phytools)
library(ggplot2)
library(ggridges)
library(gridExtra)
source("00_utility_functions.R")
#############################################################
#############################################################
# STEM NODE
climber_clades_stem <- readRDS("stem.bg.clades.list.Rdata")
all_climbers_stem <- climber_clades_stem[[1]]
all_climbers_stem <- all_climbers_stem[-1,]
all_climbers_stem$div_rate_eps0 <- NA
all_climbers_stem$div_rate_eps0.5 <- NA
all_climbers_stem$div_rate_eps0.9 <- NA
for(u in 1:nrow(all_climbers_stem)) {
all_climbers_stem$div_rate_eps0[u] <- round(bd.ms(phy=NULL, all_climbers_stem$age_mean[u], all_climbers_stem$diversity[u], crown=F, epsilon=0),3)
all_climbers_stem$div_rate_eps0.5[u] <- round(bd.ms(phy=NULL, all_climbers_stem$age_mean[u], all_climbers_stem$diversity[u], crown=F, epsilon=0.5),3)
all_climbers_stem$div_rate_eps0.9[u] <- round(bd.ms(phy=NULL, all_climbers_stem$age_mean[u], all_climbers_stem$diversity[u], crown=F, epsilon=0.9),3)
}
#View(all_climbers_stem)
all_genera_tree <- read.tree("climber_genera_tree.tre")
#########################################################
# Comparison including tendrils (trait 2) as specialized mechanism, 0 extinction
all_climbers_comparison1 = all_climbers_stem
all_climbers_comparison1$CM[which(all_climbers_comparison1$CM==1)] <- "Other"
all_climbers_comparison1$CM[which(all_climbers_comparison1$CM==2)] <- "Specialist"
all_climbers_comparison1$CM[which(all_climbers_comparison1$CM==3)] <- "Other"
all_climbers_comparison1$CM[which(all_climbers_comparison1$CM==4)] <- "Other"
all_climbers_comparison1$CM[which(all_climbers_comparison1$CM==5)] <- "Other"
all_climbers_comparison1$CM[which(all_climbers_comparison1$CM==6)] <- "Other"
all_climbers_comparison1$CM[which(all_climbers_comparison1$CM==7)] <- "Other"
all_climbers_comparison1$CM[which(all_climbers_comparison1$CM==8)] <- "Other"
#########################################################
# Superrosids
all_climbers_comparison1_sros <- subset(all_climbers_comparison1, all_climbers_comparison1$clade=="Superrosids")
div_rates_sros <- all_climbers_comparison1_sros$div_rate_eps0
names(div_rates_sros) <- all_climbers_comparison1_sros$taxa
mech_sros <- all_climbers_comparison1_sros$CM
names(mech_sros) <- all_climbers_comparison1_sros$taxa
all_genera_tree_ros <- keep.tip(all_genera_tree, all_climbers_comparison1_sros$taxa)
climb_comparison1_ros_stem <- phylANOVA(all_genera_tree_ros, mech_sros, div_rates_sros ,nsim=1000, p.adj="bonferroni")
all_genera_tree_ros
climb_comparison1_ros_stem
all_genera_tree_ros
div_rates_sros
median(div_rates_sros)
mean(div_rates_sros)
div_rates_sros
mech_sros
all_climbers_comparison1
####
#median
all_climbers_comparison1$div_rate_eps0
all_climbers_comparison1$taxa
all_climbers_comparison1$clade
####
#median
subset(all_climbers_comparison1$clade=="Superrosids")
####
#median
subset(all_climbers_comparison1, all_climbers_comparison1$clade=="Superrosids")
all_climbers_comparison1
####
#median
rosids <- subset(all_climbers_comparison1, all_climbers_comparison1$clade=="Superrosids")
asterids <- subset(all_climbers_comparison1, all_climbers_comparison1$clade=="Superasterids")
rosids
median(rosids$div_rate_eps0)
median(rosids$div_rate_eps0.9)
median(rosids$div_rate_eps0)
median(rosids$div_rate_eps0.9)
median(asterids$div_rate_eps0)
median(asterids$div_rate_eps0.9)
median(rosids$div_rate_eps0[rosids$CM=="Specialist"])
median(rosids$div_rate_eps0[rosids$CM=="Other"])
median(rosids$div_rate_eps0[rosids$CM=="Specialist"])
median(rosids$div_rate_eps0[rosids$CM=="Other"])
median(rosids$div_rate_eps0.9[rosids$CM=="Specialist"])
median(rosids$div_rate_eps0.9[rosids$CM=="Other"])
median(asterids$div_rate_eps0[rosids$CM=="Specialist"])
median(asterids$div_rate_eps0[asterids$CM=="Specialist"])
median(asterids$div_rate_eps0.9[asterids$CM=="Other"])
median(rosids$div_rate_eps0.9[rosids$CM=="Specialist"])
median(rosids$div_rate_eps0.9[rosids$CM=="Other"])
median(rosids$div_rate_eps0[rosids$CM=="Other"])
median(asterids$div_rate_eps0[asterids$CM=="Other"])
median(rosids$div_rate_eps0.9[rosids$CM=="Specialist"])
median(asterids$div_rate_eps0.9[asterids$CM=="Specialist"])
median(asterids$div_rate_eps0.9[asterids$CM=="Other"])
median(rosids$div_rate_eps0.9[rosids$CM=="Other"])
library(ape)
library(phangorn)
library(parallel)
library(geiger)
setwd("~/Desktop/Pubs_inprep/WCVP_special_issue/Patricia_Climbers/climbers")
climber_clades_stem <- readRDS("stem.bg.clades.list.Rdata")
all_climbers_stem <- climber_clades_stem[[7]]
# get diversification rates
lsca.df.sum1 <- all_climbers_stem[1:6,]
epsilon_high <- 0.9 #
root.age <- as.numeric(lsca.df.sum1[1,'age_mean'])
r_all_angios <- bd.ms(time = as.numeric(lsca.df.sum1[1,'age_mean']), n = as.numeric(lsca.df.sum1[1,'diversity']), crown = FALSE, epsilon = epsilon_high)
r_magnoliids <- bd.ms(time = as.numeric(lsca.df.sum1[2,'age_mean']), n = as.numeric(lsca.df.sum1[2,'diversity']), crown = FALSE, epsilon = epsilon_high)
r_monocots <- bd.ms(time = as.numeric(lsca.df.sum1[3,'age_mean']), n = as.numeric(lsca.df.sum1[3,'diversity']), crown = FALSE, epsilon = epsilon_high)
r_rosids <- bd.ms(time = as.numeric(lsca.df.sum1[4,'age_mean']), n = as.numeric(lsca.df.sum1[4,'diversity']), crown = FALSE, epsilon = epsilon_high)
r_asterids <- bd.ms(time = as.numeric(lsca.df.sum1[5,'age_mean']), n = as.numeric(lsca.df.sum1[5,'diversity']), crown = FALSE, epsilon = epsilon_high)
r_ranunculales <- bd.ms(time = as.numeric(lsca.df.sum1[6,'age_mean']), n = as.numeric(lsca.df.sum1[6,'diversity']), crown = FALSE, epsilon = epsilon_high)
tot.div1 <- c(as.numeric(lsca.df.sum1[1,'diversity']),
as.numeric(lsca.df.sum1[2,'diversity']),
as.numeric(lsca.df.sum1[3,'diversity']),
as.numeric(lsca.df.sum1[4,'diversity']),
as.numeric(lsca.df.sum1[5,'diversity']),
as.numeric(lsca.df.sum1[6,'diversity']))
all_r <- c(r_all_angios, r_magnoliids, r_monocots, r_rosids, r_asterids, r_ranunculales)
getStemLimits <- function(time, e=epsilon, r) {
t(sapply(time, stem.limits, epsilon=e, r=r))
}
limits <- mclapply(all_r, getStemLimits, time=2:root.age, e=epsilon_high, mc.cores = detectCores()-1)
limits.df_high <- data.frame(rbind(limits[[1]], limits[[2]],
limits[[3]], limits[[4]],
limits[[5]], limits[[6]]),
Diversity=factor(rep(tot.div1, each=nrow(limits[[1]]))),
r=rep(all_r, each=nrow(limits[[1]])))
colnames(limits.df_high)[1:2] <- c("lb", "ub")
epsilon_low <- 0 #
root.age <- as.numeric(lsca.df.sum1[1,'age_mean'])
r_all_angios <- bd.ms(time = as.numeric(lsca.df.sum1[1,'age_mean']), n = as.numeric(lsca.df.sum1[1,'diversity']), crown = FALSE, epsilon = epsilon_low)
r_magnoliids <- bd.ms(time = as.numeric(lsca.df.sum1[2,'age_mean']), n = as.numeric(lsca.df.sum1[2,'diversity']), crown = FALSE, epsilon = epsilon_low)
r_monocots <- bd.ms(time = as.numeric(lsca.df.sum1[3,'age_mean']), n = as.numeric(lsca.df.sum1[3,'diversity']), crown = FALSE, epsilon = epsilon_low)
r_rosids <- bd.ms(time = as.numeric(lsca.df.sum1[4,'age_mean']), n = as.numeric(lsca.df.sum1[4,'diversity']), crown = FALSE, epsilon = epsilon_low)
r_asterids <- bd.ms(time = as.numeric(lsca.df.sum1[5,'age_mean']), n = as.numeric(lsca.df.sum1[5,'diversity']), crown = FALSE, epsilon = epsilon_low)
r_ranunculales <- bd.ms(time = as.numeric(lsca.df.sum1[6,'age_mean']), n = as.numeric(lsca.df.sum1[6,'diversity']), crown = FALSE, epsilon = epsilon_low)
tot.div1 <- c(as.numeric(lsca.df.sum1[1,'diversity']),
as.numeric(lsca.df.sum1[2,'diversity']),
as.numeric(lsca.df.sum1[3,'diversity']),
as.numeric(lsca.df.sum1[4,'diversity']),
as.numeric(lsca.df.sum1[5,'diversity']),
as.numeric(lsca.df.sum1[6,'diversity']))
all_r <- c(r_all_angios, r_magnoliids, r_monocots, r_rosids, r_asterids, r_ranunculales)
getStemLimits <- function(time, e=epsilon, r) {
t(sapply(time, stem.limits, epsilon=e, r=r))
}
limits <- mclapply(all_r, getStemLimits, time=2:root.age, e=epsilon_low, mc.cores = detectCores()-1)
limits.df_low <- data.frame(rbind(limits[[1]], limits[[2]],
limits[[3]], limits[[4]],
limits[[5]], limits[[6]]),
Diversity=factor(rep(tot.div1, each=nrow(limits[[1]]))),
r=rep(all_r, each=nrow(limits[[1]])))
colnames(limits.df_low)[1:2] <- c("lb", "ub")
################################################
subset_stem <- subset(all_climbers_stem, !is.na(all_climbers_stem$clade))
subset_stem_t <- subset(subset_stem, subset_stem$CM==2)
subset_stem_other <- subset(subset_stem, subset_stem$CM!=2)
########################################################################################
# ROSIDS
par(mar=c(3,2,1,0.5))
par(lwd=.3)
par(mfrow=c(2,1))
pal <- hcl.colors(5, palette = "Viridis", alpha = 0.7)
names(pal) <- c("Superasterids","Superrosids","Ranunculales","Monocots","Magnoliids")
plot(x=subset_stem_t$age_mean[subset_stem_t$clade=="Superrosids"], y=subset_stem_t$diversity[subset_stem_t$clade=="Superrosids"], ylim=c(1,1000), xlim=c(0,30), log="y", xaxt="n", yaxt="n", bty="n", xlab="", ylab="", pch=24, bg=pal['Superrosids'], cex=1, lwd=0.5)
points(x=subset_stem_other$age_mean[subset_stem_other$clade=="Superrosids"], y=subset_stem_other$diversity[subset_stem_other$clade=="Superrosids"], pch=21, bg=pal['Superrosids'], cex=1, lwd=0.5)
# adding axes
par(lwd=.6)
axis(side=1, at = seq(0,260,10), labels = seq(0,260,10), tick = TRUE, line = 0, lwd = .4, cex.axis=.6, tcl=NA, mgp=c(0,0.1,0),las=1, cex.lab=.4)
axis(side=2, at = 10^{0:5}, labels = 10^{0:5}, tick = TRUE, line = 0, lwd = .4, cex.axis=.6, tcl=NA, mgp=c(2.5,0.2,0),las=1)
mtext(text="Stem age (Mya)", side=1, line=1, cex=.5)
par(las=0)
mtext(text="Species richness", side=2, line=1.5, cex=.5)
par(lwd=.5)
# adding CI lines
length_x <- length(limits.df_low$lb[limits.df_low$Diversity==111856])
lines(y=limits.df_low$lb[limits.df_low$Diversity==111856], x=1:length_x)
lines(y=limits.df_low$ub[limits.df_low$Diversity==111856], x=1:length_x)
lines(y=limits.df_high$lb[limits.df_high$Diversity==111856], x=1:length_x,lty=2)
lines(y=limits.df_high$ub[limits.df_high$Diversity==111856], x=1:length_x,lty=2)
#legend(lty=1:5, c("All angiosperms","Magnoliids","Monocots","Superasterids","Superrosids"), x=150, y=5, bty="n", cex = .7, lwd=.8)
legend(pch=c(21,24), legend = c("other", "tendrils"), x=0, y=1000, bty="n", cex = .7, pt.cex=1.25)
################
test.line_low <- approxfun(x=1:length_x, y=limits.df_low$lb[limits.df_low$Diversity==111856])
test.line_high <- approxfun(x=1:length_x, y=limits.df_high$ub[limits.df_high$Diversity==111856])
keep <- c()
for(i in 1:nrow(subset_stem)) {
if(!is.na(test.line_low(subset_stem$age_mean[i]))){
if(test.line_low(subset_stem$age_mean[i]) > subset_stem$diversity[i])
keep <- c(keep,i)
}
}
# clades below lower bound:
lower_div <- as.data.frame(subset_stem[keep,])
lower_div <- subset(lower_div, lower_div$clade=="Superrosids")
lower_div
length(lower_div)
nrow(lower_div)
nrow(upper_div) # number above upper bound
subset_stem
nrow(subset_stem)
subset_stem[subset_stem$clade=="Superrosids"]
subset_stem[subset_stem$clade=="Superrosids",]
nrow(subset_stem[subset_stem$clade=="Superrosids",]) # number below lower bound
nrow(subset_stem[subset_stem$clade=="Superrosids",]) - nrow(lower_div) - nrow(upper_div) # number below lower bound
############################################################
# ASTERIDS
par(mar=c(3,2,1,0.5))
par(lwd=.3)
pal <- hcl.colors(5, palette = "Viridis", alpha = 0.7)
names(pal) <- c("Superasterids","Superrosids","Ranunculales","Monocots","Magnoliids")
plot(x=subset_stem_t$age_mean[subset_stem_t$clade=="Superasterids"], y=subset_stem_t$diversity[subset_stem_t$clade=="Superasterids"], ylim=c(1,1000), xlim=c(0,30), log="y", xaxt="n", yaxt="n", bty="n", xlab="", ylab="", pch=24, bg=pal['Superasterids'], cex=1, lwd=0.5)
points(x=subset_stem_other$age_mean[subset_stem_other$clade=="Superasterids"], y=subset_stem_other$diversity[subset_stem_other$clade=="Superasterids"], pch=21, bg=pal['Superasterids'], cex=1, lwd=0.5)
# adding axes
par(lwd=.6)
axis(side=1, at = seq(0,260,10), labels = seq(0,260,10), tick = TRUE, line = 0, lwd = .4, cex.axis=.6, tcl=NA, mgp=c(0,0.1,0),las=1, cex.lab=.4)
axis(side=2, at = 10^{0:5}, labels = 10^{0:5}, tick = TRUE, line = 0, lwd = .4, cex.axis=.6, tcl=NA, mgp=c(2.5,0.2,0),las=1)
mtext(text="Stem age (Mya)", side=1, line=1, cex=.5)
par(las=0)
mtext(text="Species richness", side=2, line=1.5, cex=.5)
par(lwd=.5)
# adding CI lines
length_x <- length(limits.df_low$lb[limits.df_low$Diversity==87302])
lines(y=limits.df_low$lb[limits.df_low$Diversity==87302], x=1:length_x)
lines(y=limits.df_low$ub[limits.df_low$Diversity==87302], x=1:length_x)
lines(y=limits.df_high$lb[limits.df_high$Diversity==87302], x=1:length_x,lty=2)
lines(y=limits.df_high$ub[limits.df_high$Diversity==87302], x=1:length_x,lty=2)
#legend(lty=1:5, c("All angiosperms","Magnoliids","Monocots","Superasterids","Superrosids"), x=150, y=5, bty="n", cex = .7, lwd=.8)
legend(pch=c(21,24), legend = c("other", "tendrils"), x=0, y=1000, bty="n", cex = .7, pt.cex=1.25)
dev.off()
test.line_low <- approxfun(x=1:length_x, y=limits.df_low$lb[limits.df_low$Diversity==87302])
test.line_high <- approxfun(x=1:length_x, y=limits.df_high$ub[limits.df_high$Diversity==87302])
keep <- c()
for(i in 1:nrow(subset_stem)) {
if(!is.na(test.line_low(subset_stem$age_mean[i]))){
if(test.line_low(subset_stem$age_mean[i]) > subset_stem$diversity[i])
keep <- c(keep,i)
}
}
# clades below lower bound:
lower_div <- as.data.frame(subset_stem[keep,])
lower_div <- subset(lower_div, lower_div$clade=="Superasterids")
keep <- c()
for(i in 1:nrow(subset_stem)) {
if(!is.na(test.line_high(subset_stem$age_mean[i]))){
if(test.line_high(subset_stem$age_mean[i]) < subset_stem$diversity[i])
keep <- c(keep,i)
}
}
# clades above upper bound:
upper_div <- as.data.frame(subset_stem[keep,])
upper_div <- subset(upper_div, upper_div$clade=="Superasterids")
nrow(lower_div) # number below lower bound
nrow(upper_div) # number above upper bound
nrow(subset_stem[subset_stem$clade=="Superasterids",]) - nrow(lower_div) - nrow(upper_div) # number below lower bound
nrow(subset_stem[subset_stem$clade=="Superasterids",])
nrow(lower_div)
nrow(upper_div)
nrow(subset_stem[subset_stem$clade=="Superasterids",])
nrow(subset_stem[subset_stem$clade=="Superasterids",]) - nrow(lower_div) - nrow(upper_div) # number below lower bound
nrow(upper_div) # number above upper bound
nrow(lower_div) # number below lower bound
########################################################################################
# ROSIDS
par(mar=c(3,2,1,0.5))
par(lwd=.3)
par(mfrow=c(2,1))
pal <- hcl.colors(5, palette = "Viridis", alpha = 0.7)
names(pal) <- c("Superasterids","Superrosids","Ranunculales","Monocots","Magnoliids")
plot(x=subset_stem_t$age_mean[subset_stem_t$clade=="Superrosids"], y=subset_stem_t$diversity[subset_stem_t$clade=="Superrosids"], ylim=c(1,1000), xlim=c(0,30), log="y", xaxt="n", yaxt="n", bty="n", xlab="", ylab="", pch=24, bg=pal['Superrosids'], cex=1, lwd=0.5)
points(x=subset_stem_other$age_mean[subset_stem_other$clade=="Superrosids"], y=subset_stem_other$diversity[subset_stem_other$clade=="Superrosids"], pch=21, bg=pal['Superrosids'], cex=1, lwd=0.5)
# adding axes
par(lwd=.6)
axis(side=1, at = seq(0,260,10), labels = seq(0,260,10), tick = TRUE, line = 0, lwd = .4, cex.axis=.6, tcl=NA, mgp=c(0,0.1,0),las=1, cex.lab=.4)
axis(side=2, at = 10^{0:5}, labels = 10^{0:5}, tick = TRUE, line = 0, lwd = .4, cex.axis=.6, tcl=NA, mgp=c(2.5,0.2,0),las=1)
mtext(text="Stem age (Mya)", side=1, line=1, cex=.5)
par(las=0)
mtext(text="Species richness", side=2, line=1.5, cex=.5)
par(lwd=.5)
# adding CI lines
length_x <- length(limits.df_low$lb[limits.df_low$Diversity==111856])
lines(y=limits.df_low$lb[limits.df_low$Diversity==111856], x=1:length_x)
lines(y=limits.df_low$ub[limits.df_low$Diversity==111856], x=1:length_x)
lines(y=limits.df_high$lb[limits.df_high$Diversity==111856], x=1:length_x,lty=2)
lines(y=limits.df_high$ub[limits.df_high$Diversity==111856], x=1:length_x,lty=2)
#legend(lty=1:5, c("All angiosperms","Magnoliids","Monocots","Superasterids","Superrosids"), x=150, y=5, bty="n", cex = .7, lwd=.8)
legend(pch=c(21,24), legend = c("other", "tendrils"), x=0, y=1000, bty="n", cex = .7, pt.cex=1.25)
################
test.line_low <- approxfun(x=1:length_x, y=limits.df_low$lb[limits.df_low$Diversity==111856])
test.line_high <- approxfun(x=1:length_x, y=limits.df_high$ub[limits.df_high$Diversity==111856])
keep <- c()
for(i in 1:nrow(subset_stem)) {
if(!is.na(test.line_low(subset_stem$age_mean[i]))){
if(test.line_low(subset_stem$age_mean[i]) > subset_stem$diversity[i])
keep <- c(keep,i)
}
}
# clades below lower bound:
lower_div <- as.data.frame(subset_stem[keep,])
lower_div <- subset(lower_div, lower_div$clade=="Superrosids")
keep <- c()
for(i in 1:nrow(subset_stem)) {
if(!is.na(test.line_high(subset_stem$age_mean[i]))){
if(test.line_high(subset_stem$age_mean[i]) < subset_stem$diversity[i])
keep <- c(keep,i)
}
}
# clades above upper bound:
upper_div <- as.data.frame(subset_stem[keep,])
upper_div <- subset(upper_div, upper_div$clade=="Superrosids")
nrow(lower_div) # number below lower bound
nrow(upper_div) # number above upper bound
############################################################
# ASTERIDS
par(mar=c(3,2,1,0.5))
par(lwd=.3)
pal <- hcl.colors(5, palette = "Viridis", alpha = 0.7)
names(pal) <- c("Superasterids","Superrosids","Ranunculales","Monocots","Magnoliids")
plot(x=subset_stem_t$age_mean[subset_stem_t$clade=="Superasterids"], y=subset_stem_t$diversity[subset_stem_t$clade=="Superasterids"], ylim=c(1,1000), xlim=c(0,30), log="y", xaxt="n", yaxt="n", bty="n", xlab="", ylab="", pch=24, bg=pal['Superasterids'], cex=1, lwd=0.5)
points(x=subset_stem_other$age_mean[subset_stem_other$clade=="Superasterids"], y=subset_stem_other$diversity[subset_stem_other$clade=="Superasterids"], pch=21, bg=pal['Superasterids'], cex=1, lwd=0.5)
# adding axes
par(lwd=.6)
axis(side=1, at = seq(0,260,10), labels = seq(0,260,10), tick = TRUE, line = 0, lwd = .4, cex.axis=.6, tcl=NA, mgp=c(0,0.1,0),las=1, cex.lab=.4)
axis(side=2, at = 10^{0:5}, labels = 10^{0:5}, tick = TRUE, line = 0, lwd = .4, cex.axis=.6, tcl=NA, mgp=c(2.5,0.2,0),las=1)
mtext(text="Stem age (Mya)", side=1, line=1, cex=.5)
par(las=0)
mtext(text="Species richness", side=2, line=1.5, cex=.5)
par(lwd=.5)
# adding CI lines
length_x <- length(limits.df_low$lb[limits.df_low$Diversity==87302])
lines(y=limits.df_low$lb[limits.df_low$Diversity==87302], x=1:length_x)
lines(y=limits.df_low$ub[limits.df_low$Diversity==87302], x=1:length_x)
lines(y=limits.df_high$lb[limits.df_high$Diversity==87302], x=1:length_x,lty=2)
lines(y=limits.df_high$ub[limits.df_high$Diversity==87302], x=1:length_x,lty=2)
#legend(lty=1:5, c("All angiosperms","Magnoliids","Monocots","Superasterids","Superrosids"), x=150, y=5, bty="n", cex = .7, lwd=.8)
legend(pch=c(21,24), legend = c("other", "tendrils"), x=0, y=1000, bty="n", cex = .7, pt.cex=1.25)
dev.off()
test.line_low <- approxfun(x=1:length_x, y=limits.df_low$lb[limits.df_low$Diversity==87302])
test.line_high <- approxfun(x=1:length_x, y=limits.df_high$ub[limits.df_high$Diversity==87302])
keep <- c()
for(i in 1:nrow(subset_stem)) {
if(!is.na(test.line_low(subset_stem$age_mean[i]))){
if(test.line_low(subset_stem$age_mean[i]) > subset_stem$diversity[i])
keep <- c(keep,i)
}
}
# clades below lower bound:
lower_div <- as.data.frame(subset_stem[keep,])
lower_div <- subset(lower_div, lower_div$clade=="Superasterids")
keep <- c()
for(i in 1:nrow(subset_stem)) {
if(!is.na(test.line_high(subset_stem$age_mean[i]))){
if(test.line_high(subset_stem$age_mean[i]) < subset_stem$diversity[i])
keep <- c(keep,i)
}
}
# clades above upper bound:
upper_div <- as.data.frame(subset_stem[keep,])
upper_div <- subset(upper_div, upper_div$clade=="Superasterids")
nrow(lower_div) # number below lower bound
nrow(upper_div) # number above upper bound
nrow(subset_stem[subset_stem$clade=="Superasterids",]) - nrow(lower_div) - nrow(upper_div) # number below lower bound
subset_stem
subset_stem
subset_stem_t
nrow()
nrow(subset_stem_t)
nrow(subset_stem_other)
subset_stem_t$clade
nrow(subset_stem_t)
subset_stem_other$clade
nrow(subset_stem_other[subset_stem_other$clade=="Superasterids",])
nrow(subset_stem_other[subset_stem_other$clade=="Superasterids",]) + nrow(subset_stem_other[subset_stem_other$clade=="Superrosids",])
