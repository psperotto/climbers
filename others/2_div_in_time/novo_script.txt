# novo script com POWO #

# setwd("G:/Meu Drive/Papers/Diversificação/climbers")

# readig packages
library(beepr)
library(phangorn)
library(ape)
library(dplyr)
library(arsenal)
library(tidyverse)
library(geiger)

# reading the data
p<- read.delim("G:/Meu Drive/Papers/Diversificação/wcvp_v7_dec_2021.txt", sep="|", header=T) 
powo<-subset(p, rank=="SPECIES") # coluna 'taxon_name' pra nomes

# filtering powo to climbing accepted species
c <- powo %>% filter(taxon_name %in% climbers$Species) # works fine
climbers_acc <- subset(c, taxonomic_status=="Accepted") # accepted names
climbers_exc <- subset(c, taxonomic_status!="Accepted") # non accepted names

# counting species of climbers per family and per genera
spp.family<-as.data.frame(table(unlist(climbers_acc$family)))
colnames(spp.family)<-c("Family", "Nr")
spp.family<-spp.family[order(-spp.family$Nr),]

spp.genera<-as.data.frame(table(unlist(climbers_acc$genus)))
colnames(spp.genera)<-c("Genus", "Nr")
spp.genera<-spp.genera[order(-spp.genera$Nr),]

#saveRDS(spp.family, file="G:/Meu Drive/Papers/Diversificação/climbers/Data/spp.family.POWO.Rdata")
#saveRDS(spp.genera, file="G:/Meu Drive/Papers/Diversificação/climbers/Data/spp.genera.POWO.Rdata")

# finding all species per genera of climbers 
sppall.POWO <- powo %>% filter(genus %in% spp.genera$Genus)
sppall.POWO <- subset(sppall.POWO,taxonomic_status=="Accepted")
sppall.POWO <- as.data.frame(table(unlist(sppall.POWO$genus)))
colnames(sppall.POWO)<-c("Genus", "Nr") 
sppall.POWO <- sppall.POWO[order(-sppall.POWO$Nr),] # agora foi!!

# calculating the proportions
percent.POWO<-data.frame(sppall.POWO$Genus, c(spp.genera$Nr/sppall.POWO$Nr))
# isso ta mto estranho, olhar melhor
colnames(percent.POWO)<-c("Genus","perc_NT_spp")
percent.POWO<-percent.POWO[order(-percent.POWO$perc_NT_spp),]

# selecting only genera with >75%
genera75<-subset(percent, perc_NT_spp>=0.75)
genera75<-genera75[order(genera75$perc_NT_spp, decreasing=T),]
rownames(genera75)<-c(1:155)
saveRDS(genera75, file="genera75.Rdata")
genera75 <- readRDS("genera75.Rdata")



### continuar das tabelas com os numeros de spp por familia e por genero e depois seguir pra tentar comparar os noems do dataase original com do POWO,
# Thais: Tipo fazer uma tabela com uma coluna de nomes antigos, uma de nomes novos e ver quais linhas so tem nomes 

ir dando um trato no abstract da dissertação pra preparar pra mandar pra new phyt
vr paper do herve sauquet age of angiosperms is unkown -> usar o stem age pra todo os clados e generos